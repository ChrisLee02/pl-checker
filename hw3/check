#!/bin/bash

TESTCASES=(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24)
TESTDIR="examples"
WRONG="$(tput setaf 1)✗$(tput sgr0)"
CORRECT="$(tput setaf 2)✓$(tput sgr0)"
echo '# Compiling...'
make

echo '# Testing k- interpreter'

for TC in "${TESTCASES[@]}"
do
    printf "Test %s..." "${TC}"
    COMM="./run ${TESTDIR}/test${TC}.k- > ${TESTDIR}/test${TC}.myout"
    if [ -f "${TESTDIR}/test${TC}.in" ]
    then
        COMM="${COMM} < ${TESTDIR}/test${TC}.in"
    fi

    #echo "${COMM}"
    eval "${COMM}"

    eval "diff ${TESTDIR}/test${TC}.out ${TESTDIR}/test${TC}.myout > /dev/null"
    if [ $? == 1 ]
    then
        echo "${WRONG}"
    else
        echo "${CORRECT}"
    fi

done
